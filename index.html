<!DOCTYPE html>
<html>

  <head>
    <!--<link rel="stylesheet" href="style.css">-->
	
<style>

svg {
    font-size: 10px;
}

.line {
    fill: none;
    stroke: steelblue;
    clip-path: url(#clip);
}


.theLine {
    clip-path: url(#clip);
}

.theCircle {
    clip-path: url(#clip);
}

.axis path,
.axis line {
    fill: none;
    stroke: #000;
    shape-rendering: crispEdges;
}

.brush .extent {
    stroke: #fff;
    fill-opacity: .125;
    shape-rendering: crispEdges;
}

rect.pane {
  	cursor: move;
  	fill: none;
  	pointer-events: all;
}

/*#####################*/

/* The Right Slider */
.e {
  fill: #35baf6;
}

/* The Left Slider */
.w {
  fill: #35baf6;
}
</style>

    <script src="vrl.js"></script>
    <script src="script.js"></script>
    <script src="focus.js"></script>
    <script src="timeline.js"></script>
    <script src="timelineHandles.js"></script>
	<!--
    <script src="Noise_data.js"></script>
	-->
    <script src="http://d3js.org/d3.v3.js"></script>
  </head>

  <body>
    <div id="FocusDIV"></div>
    <div id="TimeLineHandlerDIV"></div>
    <div id="TimeLineDIV"></div>

    <script>
//#######################################################	
	//==< for browser logs >===
	function log(msg, color) {
		
		if($.browser.msie){
			console.log(msg);
		}
		else {
			console.log("%c" + msg, "color:" + color + ";font-weight:bold;");
		}
	}
	function log(msg) {
		console.log(msg);
	}
	//==< for browser logs >===
	
//#######################################################
//For the Observer Pattern

var Subject = (function (window, undefined) {

	function Subject() {
		this._list = [];
	}

	// this method will handle adding observers to the internal list
	Subject.prototype.observe = function observeObject(obj) {
		console.log('added new observer');
		this._list.push(obj);
	};

	Subject.prototype.unobserve = function unobserveObject(obj) {
		for (var i = 0, len = this._list.length; i < len; i++) {
			if (this._list[i] === obj) {
				this._list.splice(i, 1);
				console.log('removed existing observer');
				return true;
			}
		}
		return false;
	};

	Subject.prototype.notify = function notifyObservers() {
		var args = Array.prototype.slice.call(arguments, 0);
		for (var i = 0, len = this._list.length; i < len; i++) {
			this._list[i].update.apply(null, args);
		}
	};

	return Subject;

})(window);



var Subject2 = (function (window, undefined) {

	function Subject2() {
		this._list = [];
	}

	// this method will handle adding observers to the internal list
	Subject2.prototype.observe = function observeObject(obj) {
		console.log('added new observer');
		this._list.push(obj);
	};

	Subject2.prototype.unobserve = function unobserveObject(obj) {
		for (var i = 0, len = this._list.length; i < len; i++) {
			if (this._list[i] === obj) {
				this._list.splice(i, 1);
				console.log('removed existing observer');
				return true;
			}
		}
		return false;
	};

	Subject2.prototype.notify = function notifyObservers() {
		var args = Array.prototype.slice.call(arguments, 0);
		for (var i = 0, len = this._list.length; i < len; i++) {
			this._list[i].update.apply(null, args);
		}
	};

	return Subject2;

})(window);

//#######################################################
	
	
        var parseDate = d3.time.format("%b %Y").parse;

        function type(d) {
            d[0] = parseDate(d[0]);
            d[1] = +d[1];
            return d;
        }
        
        var values = [
			["Jan 2000", 1394.46],
			["Feb 2000", 1366.42],
			["Mar 2000", 1498.58],
			["Apr 2000", 1452.43],
			["May 2000", 1420.6],
			["Jun 2000", 1454.6],
			["Jul 2000", 1430.83],
			["Aug 2000", 1517.68],
			["Sep 2000", 1436.51],
			["Oct 2000", 1429.4],
			["Nov 2000", 1314.95],
			["Dec 2000", 1320.28],
			["Jan 2001", 1366.01],
			["Feb 2001", 1239.94],
			["Mar 2001", 1160.33],
			["Apr 2001", 1249.46],
			["May 2001", 1255.82],
			["Jun 2001", 1224.38],
			["Jul 2001", 1211.23],
			["Aug 2001", 1133.58],
			["Sep 2001", 1040.94],
			["Oct 2001", 1059.78],
			["Nov 2001", 1139.45],
			["Dec 2001", 1148.08],
			["Jan 2002", 1130.2],
			["Feb 2002", 1106.73],
			["Mar 2002", 1147.39],
			["Apr 2002", 1076.92],
			["May 2002", 1067.14]
        ];

            values.forEach(type);
			
//#######################################################

//global namespace
//var VRL = VRL || {};

	/*
			
 //#######################################################    
//The styles for TheData 
VRL.DataStyle = function() {
	var dataColor = "0000ff"; // hex
	var lineSize = 5; //in pixels
	var timelineSize = 20; //in pixels
	
	this.dataColor = function(_) {
			if (!arguments.length)
				return dataColor;
			dataColor = _;
	};
	this.lineSize = function(_) {
			if (!arguments.length)
				return lineSize;
			lineSize = _;
	};
	this.timelineSize = function(_) {
			if (!arguments.length)
				return timelineSize;
			timelineSize = _;
	};
}
 
//The Data
VRL.TheData = function(data) {
		data = JSON.parse(data);
		var dataName = data.name;
		var dataSource = data.source;
		var dataType = data.type;
		var dataInfo = data.valueInfo;
		var data = data.values;					
		
		this.style = new VRL.DataStyle();
		
		this.dataName = function(_) {
				if (!arguments.length)
					return dataName;
				dataName = _;
		};
		this.dataSource = function(_) {
				if (!arguments.length)
					return dataSource;
				dataSource = _;
		};
		this.dataType = function(_) {
				if (!arguments.length)
					return dataType;
				dataType = _;
		};
		this.dataInfo = function(_) {
				if (!arguments.length)
					return dataInfo;
				dataInfo = _;
		};
		this.data = function(_) {
				if (!arguments.length)
					return data;
				data = _;
		};
				
}

			
	*/
	
			/*
			TheData.prototype.getDataName = function(_) {
					if (!arguments.length)
						return dataName;
					dataName = _;
					//return timelineHandles;
			};
			*/
 
 var jsonData = "{	\"name\" : \"Noise Data\",\"Source\" : \"Android Mobile\"," + 
		"\"type\" : \"2\",	\"valueInfo\" : {\"max\" : \"10.682592592592593\",\"min\" : \"0.34703703703703703\"," +
		"\"threshold\" : \"8\"	},	\"values\" : [{	\"timestamp\" : \"1429650061696\",\"value\" : \"0.6388888888888888\"" +
		"}, {\"timestamp\" : \"1429650064693\",	\"value\" : \"2.442962962962963\"}]}";
			//var theD = new VRL.TheData(jsonData);
			
			var TheApp = VRL();
			//TheApp.addData(jsonData);
			//log(TheApp.allData);
			//log(TheApp.getData());
			
			//log(theD.style.dataColor());
			//log(theD.dataName());
	
			
			
			
			
			
			
			//
			//var widget = myWidget();
			
			
			var timelineHandles = TheTimelineHandles();
			var timeline = TheTimeline();
			var focus = TheFocus();
		   
		   
		   
		   
		   
		   
		   //log(values);
		   
		   /*
		   d3.select('#TimeLineHandlerDIV')
                    .datum(values)
                    .call(widget);
			*/
			
			var theData = [];
			
			//log("here we go");
			
			d3.json("data/Noise_data.json", function (data) {
				//log(data.values);
				//log("here", "red");
				//theData.push(data);	
				TheApp.addData(data);
				
				loadData2()
			});
			function loadData2() {
				d3.json("data/Noise_data3.json", function (data) {				
					//theData.push(data);	
					TheApp.addData(data);
					TheApp.getDataAt(1).style.dataColor("#ff0000");
					loadData3();
				});	
			}
			function loadData3() {
				d3.json("data/2015-04-21-230058_Ordinal_data.json", function (data) {				
					//theData.push(data);	
					TheApp.addData(data);
					TheApp.getDataAt(2).style.dataColor("#00ff00");
					TheApp.getDataAt(2).styles.push("#007900");
					TheApp.getDataAt(2).styles.push("#00df00");
					TheApp.getDataAt(2).styles.push("#3cff3c");
					loadData4();
				});	
			}
			function loadData4() {
				d3.json("data/2015-04-21-230058_Nominal_data.json", function (data) {				
					//theData.push(data);	
					TheApp.addData(data);
					TheApp.getDataAt(3).style.dataColor("#000000");
					loadChart();
				});	
			}
			
			function loadChart() {
				//log(theData);
				//var dat = TheApp.getData();
				//log("array size = " + dat.length);
				
				d3.select('#TimeLineHandlerDIV')
						.datum(TheApp.getData())
						.call(timelineHandles);
				//equivalent to : timelineHandles(d3.select('#TimeLineHandlerDIV').datum(theData))
				
				d3.select('#TimeLineDIV')
						.datum(TheApp.getData())
						.call(timeline);
				
				d3.select('#FocusDIV')
						.datum(TheApp.getData())
						.call(focus);
				
				loadMoreData();
				
			}

			var someObserver = {
				update : function () {
					console.log('"update" called: ', arguments);
				}
			};
			
			//adding the Observers
			timelineHandles.addObserver(timeline);
			timelineHandles.addObserver(focus);
			
			timeline.addObserver(timelineHandles);
			timeline.addObserver(focus);
			
			function loadMoreData() {
				//widget.addData();
			}
			
			
			
					
    </script>
  </body>

</html>